{"version":3,"sources":["meteor://ðŸ’»app/imports/api/collections/collections.js","meteor://ðŸ’»app/imports/api/collections/methods.js","meteor://ðŸ’»app/imports/api/collections/publications.js","meteor://ðŸ’»app/imports/api/prints/methods.js","meteor://ðŸ’»app/imports/api/prints/prints.js","meteor://ðŸ’»app/imports/api/prints/publications.js","meteor://ðŸ’»app/imports/api/searches/methods.js","meteor://ðŸ’»app/imports/api/searches/publications.js","meteor://ðŸ’»app/imports/api/searches/searches.js","meteor://ðŸ’»app/imports/startup/server/fixtures.js","meteor://ðŸ’»app/imports/startup/server/index.js","meteor://ðŸ’»app/imports/startup/server/register-api.js","meteor://ðŸ’»app/server/main.js"],"names":["module","export","Collections","Mongo","watch","require","v","SimpleSchema","Meteor","Collection","deny","insert","update","remove","Schema","type","String","label","optional","defaultValue","index","unique","allowedValues","Boolean","Date","autoValue","isInsert","isUpdate","attachSchema","publicFields","collection_id","collection_name","collection_type","private","created","updated","DDPRateLimiter","AWS","default","config","region","rekognition","Rekognition","methods","newCol","console","log","col","Error","colId","check","print","publish","collectionId","find","sort","fields","subscribeToCollectionsRule","name","addRule","Prints","newPrint","print_adder","userId","print_collection","findOne","collection","print_name","print_img","img","simpleSchema","clean","faceParams","CollectionId","ExternalImageId","Image","Buffer","from","split","DetectionAttributes","faceRequest","indexFaces","promise","indexFace","then","result","print_id","FaceRecords","Face","FaceId","catch","error","code","message","printId","Object","blackbox","print_type","print_details","selector","subscribeToPrintsRule","Searches","picData","t0","getTime","imgBytes","moderationParams","labelParams","rekognitionParams","moderationRequest","detectModerationLabels","labelRequest","detectLabels","detectFaces","rekognitionRequest","searchFacesByImage","promise1","promise2","promise3","promise4","response","Promise","all","values","t1","search_results","moderation","ModerationLabels","labels","Labels","faceDetails","FaceDetails","person","FaceMatches","search","saveSearch","reason","details","finally","searchId","runScanRule","subscribeToSearchesRule","isServer","startup","_ensureIndex","search_id","search_type","search_collections","search_image","colParams","colRequest","listCollections","cols","CollectionIds","length","_","each","awsCol","existingCol","upsert","$set","JSON","stringify","listFaces","faces","Faces","face","awsFace","ImageId","existingFace","count","seedPrints","times","faker","helpers","userCard","random","uuid","image","avatar","push","HTTP","os","server_mode","isProduction","settings","info","process","env","BUILD","hostname","getData","results","call","data","headers","e","onConnection","connection","clientAddr","clientAddress","httpHeaders"],"mappings":"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","file":"/app.js","sourcesContent":["import { Mongo } from 'meteor/mongo';\nimport { SimpleSchema } from 'meteor/aldeed:simple-schema';\n\n\n\nexport const Collections = new Meteor.Collection('collections');\n\n// Deny all client-side updates since we will be using methods to manage this collection\nCollections.deny({\n  insert() { return true; },\n  update() { return true; },\n  remove() { return true; },\n});\n\nCollections.Schema = new SimpleSchema({\n  // Our schema rules will go here.\n  \"collection_id\": {\n    type: String,\n    label: \"Collection ID\",\n    optional: false,\n    defaultValue: \"Collection ID\",\n    index: true,\n    unique: true\n  },\n  \"collection_name\": {\n    type: String,\n    label: \"Collection Name\",\n    optional: false,\n    defaultValue: \"MyCollection\",\n    index: true\n  },\n  \"collection_type\": {\n    type: String,\n    label: \"Collection type\",\n    optional: false,\n    allowedValues: [\"face\", \"voice\"],\n    defaultValue: \"face\"\n  },\n  \"private\": {\n    type: Boolean,\n    label: \"Collection privacy\",\n    optional: false,\n    defaultValue: true\n  },\n  \"created\": {\n    type: Date,\n    label: \"Date collection added to Antennae\",\n    autoValue: function() {\n      if ( this.isInsert ) {\n        return new Date;\n      } \n    },\n    optional: true\n  },\n  \"updated\": {\n    type: Date,\n    label: \"Date collection updated in System\",\n    autoValue: function() {\n      if ( this.isUpdate ) {\n        return new Date;\n      } \n    },\n    optional: true\n  }\n});\n\nCollections.attachSchema( Collections.Schema ); \n\n\nCollections.publicFields = {\n  collection_id: 1,\n  collection_name: 1,\n  collection_type: 1,\n  private: 1,\n  created: 1,\n  updated: 1\n};\n\n// Collections.helpers({\n//   // A collections is considered to be private if \"private\" is set to true\n//   isPrivate() {\n//     return this.private;\n//   }\n// });","import { DDPRateLimiter } from 'meteor/ddp-rate-limiter';\nimport AWS from 'aws-sdk';\n\nimport { Collections } from './collections.js';\n\nAWS.config.region = 'us-east-1';\nvar rekognition = new AWS.Rekognition();\n\nMeteor.methods({\n\t\"collection.save\"(newCol){\n\t\tconsole.log(newCol);\n\t\tlet col = Collections.insert(newCol);\n\t\tif(col){\n\t\t\tconsole.log(`added collection: ${col}`);\n\t\t}else{\n            console.log(newCol);\n            throw new Meteor.Error('add-collection-error',`error adding collection: ${newCol}`)\t\t\n\t\t}\n\t\treturn `added collection: ${col}`;\n\t},\n\n\t\"collection.delete\"(colId){\n\t\tcheck(colId,String);\n\t\tif(colId){\n\t\t\tlet print = Collections.remove(colId);\n\t\t\tconsole.log(`deleted collection: ${colId}`);\n\t\t\treturn `deleted collection: ${colId}`;\n\t\t};\n\t}\n})\n\n// Define a rule to limit method calls\n// let runScanRule = {\n// \ttype: 'method',\n// \tname: 'moment.scan'\n// };\n// Add the rule, allowing up to 1 scan every 10 seconds\n// DDPRateLimiter.addRule(runScanRule, 1, 10000);","import { DDPRateLimiter } from 'meteor/ddp-rate-limiter';\n\nimport { Collections } from './collections.js';\n\n\nMeteor.publish('collections.get', function(collectionId='') {\n\tcheck(collectionId,String);\n\tcollectionId = collectionId || {};\n  \t// console.log(Collections.find(collectionId).count());\n\treturn Collections.find(\n\t\tcollectionId, \n\t  { \n\t  \tsort: { created: -1 } \n\t}\n\t, {\n\t\tfields: Collections.publicFields\n\t});\n});\n\n// Define a rule to limit subscription calls\nvar subscribeToCollectionsRule = {\n  type: 'subscription',\n  name: 'collections.get'\n}\n// Add the rule, allowing up to 1 subscription every 5 seconds.\nDDPRateLimiter.addRule(subscribeToCollectionsRule, 1, 5000);","import { DDPRateLimiter } from 'meteor/ddp-rate-limiter';\nimport AWS from 'aws-sdk';\n\nimport { Collections } from '../collections/collections.js';\nimport { Prints } from './prints.js';\n\nAWS.config.region = 'us-east-1';\nvar rekognition = new AWS.Rekognition();\n\nMeteor.methods({\n\t\"print.save\"(newPrint){\n\t\tnewPrint.print_adder = this.userId || \"null\";\n\t\tnewPrint.print_collection = Collections.findOne(newPrint.collection).collection_id || \"people\";\n\t\tnewPrint.print_name = newPrint.name;\n\t\tnewPrint.print_img = newPrint.img;\n\t\t// console.log(newPrint);\n\t\tif(!newPrint){\n\t\t\tthrow new Meteor.Error('invalid-print','submitted print is invalid!');\n\t\t};\n\t\tPrints.simpleSchema().clean(newPrint);\n        // index a face into a collection\n        let faceParams = {\n          CollectionId: newPrint.print_collection,\n          ExternalImageId: newPrint.print_name,\n\t\t  Image: { \n\t\t\t\"Bytes\": new Buffer.from(newPrint.print_img.split(\",\")[1], \"base64\"),\n\t\t  },\n          DetectionAttributes: [\"ALL\"]\n        };\n        let faceRequest = rekognition.indexFaces(faceParams);\n        let promise = faceRequest.promise();\n        let indexFace = promise.then(result => {\n        \tconsole.log(result);\n        \tnewPrint.print_id = result.FaceRecords[0].Face.FaceId;\n\t\t\tlet print = Prints.insert(newPrint);\n        \tconsole.log(`inserted: ${print}`);\n        \treturn result;\n        }).catch(error => {\n        \tthrow new Meteor.Error(error.code, error.message, error);\n        \treturn error;\n        });\n\t\treturn indexFace;\n\t},\n\n\t\"print.delete\"(printId){\n\t\tcheck(printId,String);\n\t\tif(printId){\n\t\t\tlet print = Prints.remove(printId);\n\t\t\tconsole.log(`deleted face: ${printId}`);\n\t\t\treturn `deleted face: ${printId}`;\n\t\t};\n\t}\n})\n\n// Define a rule to limit method calls\n// let runScanRule = {\n// \ttype: 'method',\n// \tname: 'print.save'\n// };\n// Add the rule, allowing up to 1 scan every 10 seconds\n// DDPRateLimiter.addRule(runScanRule, 1, 10000);","import { Mongo } from 'meteor/mongo';\nimport { SimpleSchema } from 'meteor/aldeed:simple-schema';\n\n\n\nexport const Prints = new Meteor.Collection('prints');\n\n// Deny all client-side updates since we will be using methods to manage this collection\nPrints.deny({\n  insert() { return true; },\n  update() { return true; },\n  remove() { return true; },\n});\n\nPrints.Schema = new SimpleSchema({\n  // Our schema rules will go here.\n  \"print_id\": {\n    type: String,\n    label: \"Print ID\",\n    optional: false,\n    defaultValue: \"AAAA-BBBB-CCCC-1111-2222-3333\",\n    index: true,\n    unique: true\n  },\n  \"print_name\": {\n    type: String,\n    label: \"Print Name\",\n    optional: false,\n    defaultValue: \"New Person\"\n  },\n  \"print_type\": {\n    type: String,\n    label: \"Print type\",\n    optional: false,\n    allowedValues: [\"face\", \"voice\", \"finger\"],\n    defaultValue: \"face\"\n  },\n  \"print_collection\": {\n    type: String,\n    label: \"Print collection\",\n    optional: false,\n    defaultValue: \"people\"\n  },\n  \"print_img\": {\n    type: String,\n    label: \"Print img\",\n    optional: true,\n    defaultValue: \"img/avatar.png\"\n  },\n  \"print_details\": {\n    type: Object,\n    label: \"Print details\",\n    optional: true,\n    blackbox: true\n  },\n  \"print_adder\": {\n    type: String,\n    label: \"User who added print\",\n    optional: false\n  },\n  \"created\": {\n    type: Date,\n    label: \"Date print added to Antennae\",\n    autoValue: function() {\n      if ( this.isInsert ) {\n        return new Date;\n      } \n    },\n    optional: true\n  },\n  \"updated\": {\n    type: Date,\n    label: \"Date print updated in System\",\n    autoValue: function() {\n      if ( this.isUpdate ) {\n        return new Date;\n      } \n    },\n    optional: true\n  }\n});\n\nPrints.attachSchema( Prints.Schema ); \n\n\nPrints.publicFields = {\n  print_id: 1,\n  print_name: 1,\n  print_type: 1,\n  print_collection: 1,\n  print_img: 1,\n  print_details: 1,\n  print_adder: 1,\n  created: 1,\n  updated: 1\n};\n\n// Prints.helpers({\n//   // A collections is considered to be private if \"private\" is set to true\n//   isPrivate() {\n//     return this.private;\n//   }\n// });","import { DDPRateLimiter } from 'meteor/ddp-rate-limiter';\n\nimport { Prints } from './prints.js';\n\n\nMeteor.publish('prints.get', function(collectionId) {\n\tcollectionId = collectionId || \"\";\n\tcheck(collectionId,String);\n\tlet selector = {\n\t\t// print_collection: collectionId\n\t};\n  \t// console.log(Collections.find(collectionId).count());\n\treturn Prints.find(\n\t\tselector, \n\t  { \n\t  \tsort: { created: -1 } \n\t}\n\t, {\n\t\tfields: Prints.publicFields\n\t});\n});\n\n// Define a rule to limit subscription calls\nvar subscribeToPrintsRule = {\n  type: 'subscription',\n  name: 'prints.get'\n}\n// Add the rule, allowing up to 1 subscription every 5 seconds.\nDDPRateLimiter.addRule(subscribeToPrintsRule, 1, 5000);","import { DDPRateLimiter } from 'meteor/ddp-rate-limiter';\nimport AWS from 'aws-sdk';\n\nimport { Searches } from './searches.js';\n\nAWS.config.region = 'us-east-1';\nvar rekognition = new AWS.Rekognition();\n\nMeteor.methods({\n\t\"search.face\"(picData){\n\t\t//return 1;\n\t\tconsole.log(\"ANALYZING IMAGE...\");\n\t\tvar t0 = new Date().getTime();\n\t\tlet imgBytes = new Buffer.from(picData.split(\",\")[1], \"base64\");\n\t\tlet moderationParams = {\n\t\t\t\"Image\": { \n\t\t\t\t\"Bytes\": imgBytes,\n\t\t\t},\n\t\t\t\"MinConfidence\": 50,\n\t\t};\n\t\tlet labelParams = {\n\t\t\t\"Image\": { \n\t\t\t\t\"Bytes\": imgBytes,\n\t\t\t},\n\t\t\t\"MaxLabels\": 20,\n\t\t\t\"MinConfidence\": 75,\n\t\t};\n\t\tlet faceParams = {\n\t\t\t\"Image\": { \n\t\t\t\t\"Bytes\": imgBytes,\n\t\t\t},\n  \t\t\t\"Attributes\": [\"ALL\"],\n\t\t};\n\t\tlet rekognitionParams = {\n\t\t\t\"CollectionId\": \"AntPay\",\n\t\t\t\"FaceMatchThreshold\": 98,\n\t\t\t\"MaxFaces\": 5,\n\t\t\t\"Image\": { \n\t\t\t\t\"Bytes\": imgBytes,\n\t\t\t},\n\t\t};\n\t\t// create request objects\n\t\tlet moderationRequest = rekognition.detectModerationLabels(moderationParams);\n\t\tlet labelRequest = rekognition.detectLabels(labelParams);\n\t\tlet faceRequest = rekognition.detectFaces(faceParams);\n\t\tlet rekognitionRequest = rekognition.searchFacesByImage(rekognitionParams);\n\t\t// create promises\n\t\tlet promise1 = moderationRequest.promise();\n\t\tlet promise2 = labelRequest.promise();\n\t\tlet promise3 = faceRequest.promise();\n\t\tlet promise4 = rekognitionRequest.promise();\n\t\t// Fulfill promises in parallel\n\t\tlet response = Promise.all([\n\t\t\tpromise1.catch(error => { throw new Meteor.Error(error.code, error.message, error);return error; }),\n\t\t\tpromise2.catch(error => { throw new Meteor.Error(error.code, error.message, error);return error; }),\n\t\t\tpromise3.catch(error => { throw new Meteor.Error(error.code, error.message, error);return error; }),\n\t\t\tpromise4.catch(error => { throw new Meteor.Error(error.code, error.message, error);return error; }),\n\t\t]).then(values => {\n\t\t\tconsole.log(values[0]);\n\t\t\tconsole.log(values[1]);\n\t\t\tconsole.log(values[2]);\n\t\t\tconsole.log(values[3]);\n\t\t\tlet t1 = new Date().getTime();\n\t\t\tconsole.log(`Response took ${t1 - t0} ms`);\n\t\t\tlet search_results = {\n\t\t\t\tmoderation: values[0].ModerationLabels,\n\t\t\t\tlabels: values[1].Labels,\n\t\t\t\tfaceDetails: values[2].FaceDetails,\n\t\t\t\tperson: values[3].FaceMatches[0]\n\t\t\t};\n\t\t\tlet search = {\n\t\t\t\t// search_image: picData,\n\t\t\t\tsearch_results: search_results\n\t\t\t};\n\t\t\tlet saveSearch = Searches.insert(search);\n\t\t\tconsole.log(saveSearch);\n\t\t\treturn values;\n\t\t}).catch(error => {\n\t\t\tconsole.log('caught error!');\n\t\t\tconsole.log(error);\n\t\t\tthrow new Meteor.Error(error.error, error.reason, error.details);\n\t\t}).finally(() => {\n\t\t\tconsole.log('finally');\n\t\t\tconsole.log(this);\n\t\t});\n\t\tconsole.log(response);\n\t\tlet t1 = new Date().getTime();\n\t\tconsole.log(`Request took ${t1 - t0} ms`);\n\t\treturn response;\n\t},\n\n\t\"search.delete\"(searchId){\n\t\tcheck(searchId,String);\n\t\tif(searchId){\n\t\t\tlet search = Searches.remove(searchId);\n\t\t\tconsole.log(`deleted search: ${searchId}`);\n\t\t\treturn `deleted search: ${searchId}`;\n\t\t};\n\t}\n})\n\n// Define a rule to limit method calls\nlet runScanRule = {\n\ttype: 'method',\n\tname: 'moment.scan'\n};\n// Add the rule, allowing up to 1 scan every 10 seconds\nDDPRateLimiter.addRule(runScanRule, 1, 10000);","import { DDPRateLimiter } from 'meteor/ddp-rate-limiter';\n\nimport { Searches } from './searches.js';\n\n\nMeteor.publish('searches.get', function(searchId='') {\n\tcheck(searchId,String);\n\tsearchId = searchId || {};\n  \t// console.log(Searches.find(searchId).count());\n\treturn Searches.find(\n\t\tsearchId, \n\t  { \n\t  \tsort: { created: -1 } \n\t}\n\t, {\n\t\tfields: Searches.publicFields\n\t});\n});\n\n// Define a rule to limit subscription calls\nvar subscribeToSearchesRule = {\n  type: 'subscription',\n  name: 'searches.get'\n}\n// Add the rule, allowing up to 1 subscription every 5 seconds.\nDDPRateLimiter.addRule(subscribeToSearchesRule, 1, 5000);","import { Mongo } from 'meteor/mongo';\nimport { SimpleSchema } from 'meteor/aldeed:simple-schema';\n\n\n\nexport const Searches = new Meteor.Collection('searches');\n\n// Deny all client-side updates since we will be using methods to manage this collection\nSearches.deny({\n  insert() { return true; },\n  update() { return true; },\n  remove() { return true; },\n});\n\nSearches.Schema = new SimpleSchema({\n  // schema rules\n  \"search_type\": {\n    type: [String],\n    label: \"Search types\",\n    optional: false,\n    allowedValues: [\"moderation\", \"label\", \"face\", \"collection\"],\n    defaultValue: [\"moderation\", \"label\", \"face\"]\n  },\n  \"search_collections\": {\n    type: [String],\n    label: \"Collections to search\",\n    optional: true,\n    defaultValue: [\"\"]\n  },\n  \"search_image\": {\n    type: String,\n    label: \"Image to search\",\n    optional: true,\n    defaultValue: \"\"\n  },\n  \"search_results\": {\n    type: Object,\n    label: \"Object of search types\",\n    optional: true,\n    blackbox: true,\n    defaultValue: {}\n  },\n  \"faces\": {\n    type: [Object],\n    label: \"Face objects found in image\",\n    optional: true,\n    blackbox: true,\n    defaultValue: []\n  },\n  \"created\": {\n    type: Date,\n    label: \"Date search performed\",\n    autoValue: function() {\n      if ( this.isInsert ) {\n        return new Date;\n      } \n    },\n    optional: true,\n    //index: true\n  },\n  \"updated\": {\n    type: Date,\n    label: \"Date search updated\",\n    autoValue: function() {\n      if ( this.isUpdate ) {\n        return new Date;\n      } \n    },\n    optional: true\n  }\n});\n\nSearches.attachSchema( Searches.Schema );\n\nif(Meteor.isServer){\n  Meteor.startup(() => {\n    Searches._ensureIndex({\n        created: -1,\n    });\n    // Searches._ensureIndex({ search_image: 1});\n  });\n}\n\nSearches.publicFields = {\n  search_id: 1,\n  search_type: 1,\n  search_collections: 1,\n  search_image: 1,\n  search_results: 1,\n  created: 1,\n  updated: 1\n};\n\n// Searches.helpers({\n//   // A collections is considered to be private if \"private\" is set to true\n//   isPrivate() {\n//     return this.private;\n//   }\n// });","import { Meteor } from 'meteor/meteor';\nimport { Collections } from '../../api/collections/collections.js';\nimport { Prints } from '../../api/prints/prints.js';\nimport { Searches } from '../../api/searches/searches.js';\nimport AWS from 'aws-sdk';\n\nAWS.config.region = 'us-east-1';\nvar rekognition = new AWS.Rekognition();\n\n// if the database is empty on server start, create some sample data.\n\nMeteor.startup(() => {\n\n  console.log(\"getting aws collections...\");\n  let colParams= {};\n  let colRequest = rekognition.listCollections(colParams);\n  let promise = colRequest.promise();\n  let cols = promise.then(result => {\n    console.log(result);\n    if(result && result.CollectionIds.length > 0){\n      _.each(result.CollectionIds, function(colId){\n        let awsCol = {\n          collection_id: colId,\n          collection_name: colId,\n          collection_type: \"face\",\n          private: true\n        };\n        let existingCol = Collections.upsert({collection_id: colId}, {$set: awsCol});\n        console.log(`upserted collection: ${JSON.stringify(existingCol)}`);\n        // Now try getting existing faces for each collection\n        let faceParams = {\n          CollectionId: colId\n        };\n        let faceRequest = rekognition.listFaces(faceParams);\n        let promise = faceRequest.promise();\n        let faces = promise.then(result => {\n          if(result && result.Faces.length > 0){\n            console.log(`collection has ${result.Faces.length} faces`);\n            _.each(result.Faces, function(face){\n              let awsFace = {\n                print_id: face.FaceId,\n                print_name: face.ExternalImageId || face.ImageId,\n                print_type: \"face\",\n                print_collection: colId,\n                print_details: face,\n                print_adder: \"root\"\n              };\n              Prints.simpleSchema().clean(awsFace);\n              let existingFace = Prints.upsert({print_id: face.FaceId}, {$set: awsFace});\n              console.log(existingFace);\n            })\n          }\n        });\n      });\n    }\n    return result;\n  });\n\n  if (Prints.find().count() < 15) {\n    console.log(\"seeding prints...\");\n    let seedPrints = []\n    _.times(5, ()=>{\n      let print = {\n        print_adder: this.userId || \"deded\",\n        print_collection: \"people\",\n        print_name: faker.helpers.userCard().name,\n        print_id: faker.random.uuid(),\n        print_img: faker.image.avatar()\n      };\n      let printId = Prints.insert(print);\n      seedPrints.push(printId);\n    });\n    console.log(seedPrints);\n\n  };\n});","/*\n * Copyright 2017-present Antmounds.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the GNU Affero General Public License, version 3.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     https://www.gnu.org/licenses/agpl-3.0.en.html\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\nimport { Meteor } from 'meteor/meteor';\nimport { HTTP } from 'meteor/http';\n// import '../accounts-config.js';\nimport './fixtures.js';\n// This defines all the collections, publications and methods that the application provides\n// as an API to the client.\nimport './register-api.js';\n\nconst os = require('os');\n\n\nserver_mode = Meteor.isProduction ? \"PRODUCTION\" : \"DEVELOPMENT\";\nconsole.log('index.js: ' + server_mode + \"-->\" + JSON.stringify(Meteor.settings));\n\nMeteor.methods({\n\n\tinfo(){\n\t\treturn `version: 0.9.0 - build: ${process.env.BUILD || 'dev'} - hostname: ${os.hostname()}`;\n\t},\n\n\tasync getData(){    \n\t\ttry{\n\t\t\tvar response = {};\n\t\t\tconst results = await HTTP.call('GET', 'http://jsonplaceholder.typicode.com/posts');\t\n\t\t\tconsole.log(JSON.stringify(results.data[0]));\t\n\t\t\tconsole.log(JSON.stringify(results.headers));\n\t\t\tresponse.code = true;\t\t\n\t\t\tresponse.data = results;\t\n\t\t} catch(e){\n\t\t\tresponse = false;\n\t\t\tconsole.log(e);\n\t\t} finally {\n\t\t\tconsole.log(\"finally...\")\n\t\t\t//throw new Meteor.Error(\"inappropriate-pic\",\"The user has taken an inappropriate picture.\");\t\n\t\t\treturn response;\n\t\t}\n\t}\n\n});\n\nMeteor.onConnection((connection)=>{\n\tlet clientAddr = connection.clientAddress;\n\tlet headers = connection.httpHeaders;\n\tconsole.log(`connection from ${clientAddr}`);\n\t// console.log(headers);\n})","import '../../api/collections/methods.js';\nimport '../../api/collections/publications.js';\nimport '../../api/searches/methods.js';\nimport '../../api/searches/publications.js';\nimport '../../api/prints/methods.js';\nimport '../../api/prints/publications.js';","/*\n * Copyright 2017-present Antmounds.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the GNU Affero General Public License, version 3.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     https://www.gnu.org/licenses/agpl-3.0.en.html\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\nimport '../imports/startup/server';\n\nMeteor.startup(() => {\n  // code to run on server at startup\n});\n"]}